# Проект Бэйрдотир
Бот-помощник с RAG-системой

## Структура репозитория
```
.
└───api_backend  
|
└───bairdotr
|
└───data
|
└───frontend
|
| docker-compose.yaml
| pyproject.toml
| poetry.lock
| README.md
```

- `api_backend` - папка с конфигурацией API, к котором могут обращаться разные выходы взаимодействия с пользователем
- `bairdotr` - основной пакет с кодом для работы с чат-ботом Бэйрдотир
- `data` - папка с данными (база знаний для RAG системы, история, контекст, пользователи)
- `frontend` - web-интерфейс на React
- docker-compose.yaml - docker-compose для одновременного поднятия всей системы
- pyproject.toml - зависимости проекта
- poetry.lock - lock-файл для настройки poetry в окружении
- README.md - readme

## Запуск
Перед первым запуском необходимо собрать проект с помощью docker compose:
```bash
docker-compose build
```

Для запуска необходимо, находясь в корне репозитория, в консоли ввести команду
```bash
docker-compose up -d
```
и подождать некоторое время (около 2 минут), чтобы все модели подгрузились.  

Во время первого запуска ответ может быть долгим, т.к. скачивается модель эмбеддингов с huggingface.

## Настройка ollama-модели
На данный момент нет автоматического скачивания моделей в контейнер с ollama. Поэтому во время первого запуска после загрузки контейнеров необходимо запустить следующую команду:
```bash
docker exec ollama_c ollama pull gemma2
```
После чего модель gemma2, на которой работает суммаризация, начнёт скачиваться. 


## Создание базы знаний по документам
Перед выполнением необходимо выполнить следующие команды:
```bash
pip install -qU langchain-unstructured "unstructured[pdf]"
apt-get install poppler-utils tesseract-ocr
```

Для создание БЗ по "сырым" pdf-документам необходимо поместить эти документы по пути `data/docs/raw` (путь, указанный в config.py как RAW_DOCS). После чего выполнить команду:
```bash
python bairdotr/prepare_raw.py
```
Обработанные документы поместятся в txt-формате по пути `data/docs/cleaned_and_prepared` (путь, указанный в config.py как PREPARED).

Если есть иные документы (docs, txt), то их в формате .txt также необходимо поместить по пути `data/docs/just_cleaned` (путь, указанный в config.py как JUST_CLEANED).

После этого необходимо выполнить в терминале команду:
```bash
python bairdotr/setup_vectorbase.py
```