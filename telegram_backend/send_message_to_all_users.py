import asyncio
from telegram import Bot
from bairdotr.config import DATA_FOLDER, TELEGRAM_CHAT_IDS_EYE
import os
from dotenv import load_dotenv

load_dotenv()

bot = Bot(token = os.environ["TELEGRAM_BOT_API"])

def read_all_saved_chat_id() -> list:
    """–ü—Ä–æ—á–µ—Å—Ç—å —Ñ–∞–π–ª —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ chat_id –∏ –≤–µ—Ä–Ω—É—Ç—å –ª–∏—Å—Ç —Å –Ω–∏–º–∏"""
    filename = DATA_FOLDER + "/" + TELEGRAM_CHAT_IDS_EYE
    with open(filename) as file:
        ids = file.readlines()
    ids = [i[:-1] for i in ids] # —É–±–∏—Ä–∞–µ–º \n –≤ –∫–æ–Ω—Ü–µ

    return ids

def get_message() -> str:
    """–°–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞–¥–æ –º–∞—Å—Å–æ–≤–æ–≥–æ —Ä–∞–∑–æ—Å–ª–∞—Ç—å"""
    return """üåü –£–≤–∞–∂–∞–µ–º—ã–µ –∫–æ–ª–ª–µ–≥–∏! üåü

–ú—ã —Ä–∞–¥—ã —Å–æ–æ–±—â–∏—Ç—å –≤–∞–º –æ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî ¬´–ü—Ä–æ–±–∏–≤ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞¬ª! üéâ 

–•–æ—Ç–∏–º –∑–∞–º–µ—Ç–∏—Ç—å —á—Ç–æ —Ñ–∏—á–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —É–∑–∫–æ–º—É —Å–µ–≥–º–µ–Ω—Ç—É –Ω–∞—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –æ–¥–Ω–∏–º –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —è–≤–ª—è–µ—Ç–µ—Å—å –í—ã! üéâ

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –∏ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª—é–¥—è—Ö, —á—Ç–æ —Å—Ç–∞–Ω–µ—Ç –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–º –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ú–î–†. –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –±–æ–ª–µ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –ø–æ–≤—ã—Å–∏—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã.

–ù–µ —É–ø—É—Å—Ç–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤! 

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–æ—â—å, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è! üôå

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,  
–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏üöÄ"""

async def send_messages():
    """–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    print("Start sending messages...")

    msg = get_message()

    ids = read_all_saved_chat_id()

    async with bot:
        for chat_id in ids:
            print(chat_id)
            await bot.send_message(
                chat_id = chat_id,
                text = msg,
                parse_mode = "Markdown"
            )

    print("Messages have sended")


if __name__ == "__main__":
    asyncio.run(send_messages())